<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #messages { border: 1px solid #ddd; padding: 10px; height: 300px; overflow-y: auto; margin-bottom: 10px; }
        button { background-color: #4CAF50; color: white; border: none; padding: 10px 15px; margin: 5px; cursor: pointer; }
        input { padding: 8px; width: 300px; }
        .status { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Simple WebSocket Test</h1>
    <div class="status">Status: <span id="status">Disconnected</span></div>
    
    <div>
        <input type="text" id="url" placeholder="WebSocket URL">
        <button id="connect">Connect</button>
        <button id="disconnect" disabled>Disconnect</button>
    </div>
    
    <script>
        // Dynamically set the WebSocket URL based on current host
        document.addEventListener('DOMContentLoaded', function() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.hostname;
            const port = '5000'; // WebSocket server port
            const wsUrl = `${protocol}//${host}:${port}`;
            document.getElementById('url').value = wsUrl;
            
            // Add debug information
            const debugInfo = document.createElement('div');
            debugInfo.style.backgroundColor = '#f8f9fa';
            debugInfo.style.padding = '10px';
            debugInfo.style.marginTop = '10px';
            debugInfo.style.borderRadius = '5px';
            debugInfo.innerHTML = `
                <h3>Debug Information</h3>
                <p><strong>Window Location:</strong> ${window.location.href}</p>
                <p><strong>Protocol:</strong> ${protocol}</p>
                <p><strong>Host:</strong> ${host}</p>
                <p><strong>Port:</strong> ${port}</p>
                <p><strong>WebSocket URL:</strong> ${wsUrl}</p>
            `;
            document.body.insertBefore(debugInfo, document.getElementById('messages'));
        });
    </script>
    
    <div id="messages"></div>
    
    <div>
        <input type="text" id="message" placeholder="Type a message...">
        <button id="send" disabled>Send</button>
    </div>
    
    <script>
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');
        const urlEl = document.getElementById('url');
        const messageEl = document.getElementById('message');
        const connectBtn = document.getElementById('connect');
        const disconnectBtn = document.getElementById('disconnect');
        const sendBtn = document.getElementById('send');
        
        let socket = null;
        
        function addMessage(message) {
            const div = document.createElement('div');
            div.textContent = message;
            messagesEl.appendChild(div);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }
        
        connectBtn.addEventListener('click', () => {
            try {
                const url = urlEl.value;
                socket = new WebSocket(url);
                
                statusEl.textContent = 'Connecting...';
                
                socket.onopen = () => {
                    statusEl.textContent = 'Connected';
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                    sendBtn.disabled = false;
                    addMessage('Connected to ' + url);
                };
                
                socket.onmessage = (event) => {
                    addMessage('Received: ' + event.data);
                };
                
                socket.onclose = () => {
                    statusEl.textContent = 'Disconnected';
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                    sendBtn.disabled = true;
                    addMessage('Connection closed');
                    socket = null;
                };
                
                socket.onerror = (error) => {
                    addMessage('Error: ' + error);
                };
            } catch (error) {
                addMessage('Error: ' + error.message);
            }
        });
        
        disconnectBtn.addEventListener('click', () => {
            if (socket) {
                socket.close();
            }
        });
        
        sendBtn.addEventListener('click', () => {
            if (socket && socket.readyState === WebSocket.OPEN) {
                const message = messageEl.value;
                if (message) {
                    socket.send(message);
                    addMessage('Sent: ' + message);
                    messageEl.value = '';
                }
            }
        });
        
        messageEl.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendBtn.click();
            }
        });
    </script>
</body>
</html>